bug fix
second bug fixed in master by others along with some changes
